<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>京东菜单</title>
		<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
	</head>
	
	<style>
		.wrap {
			position: relative;
			width: 200px;
			left: 50px;
			top: 50px;
		}
		ul{
			padding: 15px 0;
			margin: 9;
			list-style: none;
			background: #6c6669;
			color: #fff;
			border-right-width: 0;
		}
		li{
			display: block;
			height: 30px;
			line-height: 30px;
			padding-left: 12px;
			cursor: pointer;
			font-size: 14px;
			position: relative;
		}
		li.active{
			background: #999395;
		}
		li span:hover{
			color:#c81623;
		}
		
		.none{
			display: none;
		}
		
		#sub{
			width: 600px;
			position: absolute;
			border: 1px solid #f7f7f7;
			background: #f7f7f7;
			box-shadow: 2px 0 5px rgba(0,0,0,0.3);
			left: 200px;
			top: 0;
			box-sizing: border-box;
			margin:0 ;
			padding: 10px;
		}
		#sub a{
			font-size: 12px;
			color: #666;
			text-decoration: none;
		}
		#sub a:hover{
			color:red;
		}
		.sub_content dd a {
			border-left: 1px solid #e0e0e0;
			padding: 0 10px;
			margin: 4px 0;
		}
		
		.sub_content dl{
			overflow: hidden;
		}
		.sub_content dt{
			float: left;
			width: 70px;
			font-weight: bold;
			clear: left;
			position: relative;
		}
		.sub_content dd{
			float: left;
			margin-left: 5px;
			border-top: 1px solid #eee;
			margin-bottom: 5px;
		}
		.sub_content dt i{
			width:4px;
			height: 14px;
			font:400 9px/14px consolas;
			position: absolute;
			right: 5px;
			top: 5px;
		}
	</style>
	<body>
		
		<div class='wrap' id="test">
			<ul>
				<li data-id="a">
					<span>家用电器</span>
				</li>
				<li data-id="b">
					<span>电脑办公</span>
				</li>
				<li data-id="c">
					<span>母婴 / 玩具乐器</span>
				</li>
				<li data-id="d">
					<span>数码 / 手机</span>
				</li>
				<li data-id="e">
					<span>汽车 / 汽车用品</span>
				</li>
				<li data-id="f">
					<span>家用电器</span>
				</li>
			</ul>
			
			
			<div id='sub' class="none">
				<div id='a' class='sub_content none'>
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					
				</div>
				
				<div id='b' class='sub_content none'>
					<dl>
						<dt>
							<a href="#">bbb<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">bbb</a>
							<a href="#">bbb</a>
							<a href="#">合资品牌</a>
							<a href="#">6666bbb6666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私bbbb人订制</a>
							<a href="#">合资bbb品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">bbbb</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					
				</div>
				<div id='c' class='sub_content none'>
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					
				</div>
				<div id='d' class='sub_content none'>
					<dl>
						<dt>
							<a href="#">电视dddddddddd<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					
				</div>
				<div id='e' class='sub_content none'>
					<dl>
						<dt>
							<a href="#">电eeeeeee视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					
				</div>
				<div id='f' class='sub_content none'>
					<dl>
						<dt>
							<a href="#">fffffffff电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					
				</div>
				<div id='g' class='sub_content none'>
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">私人订制</a>
							<a href="#">合资品牌</a>
							<a href="#">66666666</a>
						</dd>
					</dl>
					
					
				</div>
			</div>
		</div>
		
		
		<script type="text/javascript">
			
			$(document).ready(function(){
				var sub = $('#sub')
				
				var activeRow  //li
				var activeMenu  //li对应的sub
				var timer
				var mouseInSub = false
				
				sub.on('mouseenter',function(){
					mouseInSub =true
				}).on('mouseleave',function(){
					mouseInSub =false
				})
				
				// 除去 延迟的  两个鼠标位置点
				var mouseTrack = []
				
				var moveHandler = function(e){
					//获取鼠标坐标
					mouseTrack.push({
						x:e.pageX,
						y:e.pageY
					})
					
					if(mouseTrack.length>3){
						mouseTrack.shift()
					}
				}
				
				$('#test').on('mouseenter',function(){
					sub.removeClass('none')
					$(document).bind('mousemove',moveHandler)
					
				}).on('mouseleave',function(){
					sub.addClass('none')
					
					if(activeRow){
						activeRow.removeClass('active')
						activeRow=null
					}
					if(activeMenu){
						activeMenu.addClass('none')
						activeMenu = null
					}
					
					//解绑
					$(document).unbind('mousemove',moveHandler)
				})
				.on('mouseenter','li',function(e){
					// 第一次进入li
					if(!activeRow){
						activeRow = $(e.target).addClass('active')
						activeMenu = $('#'+activeRow.data('id'))
						activeMenu.removeClass('none')
						return 
					}
					
					if(timer){
						clearTimeout(timer)
					}
					
					//当前鼠标坐标
					var currMousePos = mouseTrack[mouseTrack.length - 1]
					
					var leftCorner = mouseTrack[mouseTrack.length-2]  //三角形左侧点
					
					var delay = needDelay(sub,leftCorner,currMousePos)
					//进入sub 需要延迟 li切换不需要
					if(delay){
						console.log(111111111111)
						timer = setTimeout(()=>{
							//一个列表 进入另一个
							if(mouseInSub){
								return 
							}
							activeRow.removeClass('active')
							activeMenu.addClass('none')
							
							activeRow = $(e.target)
							activeRow.addClass('active')
							activeMenu = $('#'+activeRow.data('id'))
							activeMenu.removeClass('none')
							
							timer = null
						},300)
					} else {
						console.log(2222222222222)
						var prevActiveRow = activeRow
						var prevActiveMenu = activeMenu
						
						activeRow = $(e.target)
						activeMenu = $('#'+activeRow.data('id'))
						
						prevActiveRow.removeClass('active')
						prevActiveMenu.addClass('none')
						activeRow .addClass('active')
						activeMenu.removeClass('none')
					}
					
					
				})
			})
		</script>
		
		
		<script>
			
			function sameSign(a,b){
				return (a^b)>=0  ;//异 运算  二进制  同为正 或者同为负
			}
			
			// 三角区域 函数
			function vector(a,b){
				//鼠标点 和 三角形顶点  做差
				return {
					x:b.x - a.x, //三角点 减当前点
					y:b.y -a.y
				}
			}
			
			//向量
			function vectorProduct(v1,v2){
				return v1.x * v2.y - v2.x* v1.y
			}
			
			//判断方法
			function isPointInTrangle(p,a,b,c){
				var pa = vector(p,a)
				var pb = vector(p,b)
				var pc = vector(p,c)
				
				//三角形的向量
				var t1 = vectorProduct(pa,pb)
				var t2 = vectorProduct(pb,pc)
				var t3 = vectorProduct(pc,pa)
				
				return sameSign(t1,t2)&& sameSign(t2,t3)&& sameSign(t1,t3)
			}
			
			function needDelay(elem,leftCorner,currMousePos){
				var offset = elem.offset()
				var topLeft = {
					x:offset.left,
					y:offset.top
				}
				var bottomLeft = {
					x:offset.left,
					y:offset.top + elem.height()
				}
				
				return isPointInTrangle(currMousePos,leftCorner,topLeft,bottomLeft)
			}
		</script>
	</body>
</html>
